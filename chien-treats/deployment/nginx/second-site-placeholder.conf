# Nginx configuration for second site placeholder
# This demonstrates the multi-site pattern without interfering with chienstreats
# Domain: secondsite-placeholder.local (for testing)
# Ports: 3102 (frontend), 4001 (API)

# Upstream definitions
upstream secondsite_frontend {
    server 127.0.0.1:3102 fail_timeout=10s max_fails=3;
    keepalive 32;
}

upstream secondsite_api {
    server 127.0.0.1:4001 fail_timeout=10s max_fails=3;
    keepalive 32;
}

# Placeholder server (HTTP only for now)
server {
    listen 8080;
    listen [::]:8080;
    server_name secondsite-placeholder.local;

    # Simple "Coming Soon" page
    root /var/www/secondsite-placeholder;

    location / {
        default_type "text/html";
        return 200 '<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Site - Coming Soon</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            text-align: center;
            padding: 2rem;
        }
        h1 {
            font-size: 3rem;
            margin: 0 0 1rem 0;
        }
        p {
            font-size: 1.25rem;
            opacity: 0.9;
        }
        .status {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        .status-item {
            display: inline-block;
            margin: 0 1rem;
        }
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            font-size: 0.875rem;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Second Site</h1>
        <p>This slot is reserved for the next deployment</p>
        <div class="status">
            <div class="status-item">
                <strong>Frontend Port:</strong> <span class="badge">3102</span>
            </div>
            <div class="status-item">
                <strong>API Port:</strong> <span class="badge">4001</span>
            </div>
        </div>
        <p style="margin-top: 2rem; font-size: 1rem; opacity: 0.7;">
            Multi-site isolation pattern active âœ“
        </p>
    </div>
</body>
</html>';
    }

    # Health check endpoint
    location /healthz {
        access_log off;
        return 200 '{"status":"placeholder","site":"secondsite"}';
        add_header Content-Type application/json;
    }
}

# Template for when second site goes live (commented out):
#
# server {
#     listen 80;
#     listen [::]:80;
#     server_name secondsite.com www.secondsite.com;
#
#     location ^~ /.well-known/acme-challenge/ {
#         default_type "text/plain";
#         root /var/www/html;
#     }
#
#     location / {
#         return 301 https://$server_name$request_uri;
#     }
# }
#
# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2;
#     server_name secondsite.com www.secondsite.com;
#
#     ssl_certificate /etc/letsencrypt/live/secondsite.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/secondsite.com/privkey.pem;
#     ssl_protocols TLSv1.2 TLSv1.3;
#
#     # Same structure as chienstreats.conf...
#     location /api/v1/ {
#         proxy_pass http://secondsite_api;
#         # ... proxy headers
#     }
#
#     location / {
#         proxy_pass http://secondsite_frontend;
#         # ... proxy headers
#     }
# }
